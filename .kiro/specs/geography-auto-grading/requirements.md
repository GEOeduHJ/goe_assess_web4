# Requirements Document

## Introduction

지리과 자동 채점 플랫폼은 교사가 학생들의 서술형 및 백지도형 답안을 효율적으로 채점할 수 있도록 지원하는 웹 기반 시스템입니다. Streamlit UI와 Google Gemini API를 활용하여 참고 자료, 평가 루브릭, 학생 답안을 종합적으로 분석하고 자동 채점 및 피드백을 제공합니다.

## Requirements

### Requirement 1

**User Story:** 교사로서, 서술형과 백지도형 중 채점 유형을 선택할 수 있어야 하므로, 각 문항 유형에 맞는 적절한 채점 프로세스를 진행할 수 있다.

#### Acceptance Criteria

1. WHEN 사용자가 플랫폼에 접속하면 THEN 시스템은 "📝 서술형 문항"과 "🗺️ 백지도형 문항" 두 가지 채점 유형 선택 옵션을 제공해야 한다
2. WHEN 사용자가 채점 유형을 선택하면 THEN 시스템은 선택된 유형에 맞는 입력 인터페이스를 표시해야 한다
3. WHEN 사용자가 채점 유형을 변경하면 THEN 시스템은 이전 입력 데이터를 초기화하고 새로운 유형에 맞는 인터페이스를 제공해야 한다

### Requirement 2

**User Story:** 교사로서, 서술형 문항 채점 시 참고 자료(PDF, DOCX)를 업로드할 수 있어야 하므로, RAG 기반으로 정확한 채점 기준을 제공받을 수 있다.

#### Acceptance Criteria

1. WHEN 서술형 문항이 선택되면 THEN 시스템은 참고 자료 업로드 섹션을 표시해야 한다
2. WHEN 사용자가 PDF 또는 DOCX 파일을 업로드하면 THEN 시스템은 문서를 청킹하고 KURE-v1 모델로 임베딩하여 FAISS 인덱스에 저장해야 한다
3. WHEN 학생 답안이 입력되면 THEN 시스템은 답안을 쿼리 벡터로 변환하여 가장 관련성 높은 문서 조각 3개를 검색해야 한다
4. IF 참고 자료가 업로드되지 않았다면 THEN 시스템은 참고 자료 없이 채점을 진행할 수 있어야 한다

### Requirement 3

**User Story:** 교사로서, 평가 루브릭을 동적으로 설정할 수 있어야 하므로, 다양한 평가 요소와 채점 기준에 따라 분석적 채점을 수행할 수 있다.

#### Acceptance Criteria

1. WHEN 사용자가 루브릭 설정 화면에 접근하면 THEN 시스템은 평가 요소와 채점 기준을 추가/삭제할 수 있는 동적 UI를 제공해야 한다
2. WHEN 사용자가 평가 요소를 추가하면 THEN 시스템은 해당 요소에 대한 채점 기준(점수, 내용)을 입력할 수 있는 필드를 제공해야 한다
3. WHEN 사용자가 루브릭을 완성하면 THEN 시스템은 입력된 루브릭을 구조화된 텍스트로 변환하여 채점 프롬프트에 포함해야 한다
4. WHEN 루브릭이 설정되지 않았다면 THEN 시스템은 사용자에게 루브릭 설정을 요구하는 메시지를 표시해야 한다

### Requirement 4

**User Story:** 교사로서, 학생 답안을 Excel 파일로 업로드할 수 있어야 하므로, 다수의 학생 답안을 일괄적으로 처리할 수 있다.

#### Acceptance Criteria

1. WHEN 서술형 문항이 선택되면 THEN 시스템은 '학생 이름', '반', '답안' 3개 열로 구성된 Excel 파일 업로드를 요구해야 한다
2. WHEN 백지도형 문항이 선택되면 THEN 시스템은 '학생 이름', '반' 2개 열로 구성된 Excel 파일과 학생 이름이 포함된 이미지 파일들의 업로드를 요구해야 한다
3. WHEN Excel 파일이 업로드되면 THEN 시스템은 파일 형식과 필수 열의 존재를 검증해야 한다
4. WHEN 백지도형에서 이미지 파일들이 업로드되면 THEN 시스템은 Excel의 학생 이름과 이미지 파일명을 매칭하여 각 학생의 답안을 식별해야 한다

### Requirement 5

**User Story:** 교사로서, LLM 모델을 선택하고 자동 채점을 실행할 수 있어야 하므로, 선호하는 AI 모델로 각 학생의 답안에 대한 정확한 채점 결과와 피드백을 받을 수 있다.

#### Acceptance Criteria

1. WHEN 서술형 문항이 선택되면 THEN 시스템은 "Google Gemini 2.5 Flash"와 "Groq Qwen3" 중 LLM 모델을 선택할 수 있는 옵션을 제공해야 한다
2. WHEN 백지도형 문항이 선택되면 THEN 시스템은 이미지 분석이 가능한 "Google Gemini 2.5 Flash" 모델을 자동으로 선택해야 한다
3. WHEN 모든 필수 데이터가 입력되고 채점 실행 버튼이 클릭되면 THEN 시스템은 채점 유형에 맞는 최적화된 프롬프트를 생성해야 한다
4. WHEN 프롬프트가 생성되면 THEN 시스템은 선택된 LLM API를 호출하여 각 학생의 답안을 분석해야 한다
5. WHEN API 호출이 완료되면 THEN 시스템은 지정된 JSON 형식으로 채점 결과, 판단 근거, 피드백을 반환받아야 한다
6. IF API 호출이 실패하면 THEN 시스템은 오류 메시지를 표시하고 재시도 옵션을 제공해야 한다

### Requirement 6

**User Story:** 교사로서, 채점 결과를 웹 UI에서 확인하고 Excel 파일로 다운로드할 수 있어야 하므로, 결과를 효과적으로 활용하고 보관할 수 있다.

#### Acceptance Criteria

1. WHEN 채점이 완료되면 THEN 시스템은 각 학생의 채점 결과, 판단 근거, 피드백을 명확하고 이해하기 쉬운 형태로 시각화해야 한다
2. WHEN 결과가 표시되면 THEN 시스템은 학생별로 평가 요소별 점수와 총점을 보여주어야 한다
3. WHEN 사용자가 Excel 다운로드를 요청하면 THEN 시스템은 학생 정보, 원본 답안, 채점 결과, 판단 근거, 피드백이 모두 포함된 Excel 파일을 생성해야 한다
4. WHEN Excel 파일이 생성되면 THEN 시스템은 파일을 사용자가 다운로드할 수 있도록 제공해야 한다

### Requirement 7

**User Story:** 교사로서, 시스템이 안정적으로 작동하고 오류 상황을 적절히 처리해야 하므로, 신뢰할 수 있는 채점 서비스를 이용할 수 있다.

#### Acceptance Criteria

1. WHEN 파일 업로드 중 오류가 발생하면 THEN 시스템은 구체적인 오류 메시지와 해결 방법을 제시해야 한다
2. WHEN 네트워크 오류로 API 호출이 실패하면 THEN 시스템은 자동으로 재시도하고 최대 3회까지 시도해야 한다
3. WHEN 시스템 처리 중 예상치 못한 오류가 발생하면 THEN 시스템은 사용자에게 친화적인 오류 메시지를 표시하고 로그를 기록해야 한다
4. WHEN 대용량 파일이나 많은 수의 학생 답안을 처리할 때 THEN 시스템은 진행 상황을 표시하고 적절한 성능을 유지해야 한다