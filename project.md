# 🗺️ 지리과 자동 채점 플랫폼: 프로젝트 구조

이 문서는 Python 기반의 지리 교과용 자동 채점 플랫폼 개발을 위한 전체 구조와 기술 명세를 정의합니다.

---

## 1. 프로젝트 개요

**Streamlit**으로 웹 UI를 구축하고 **Google Gemini API**를 채점 엔진으로 활용하는 지리 교과목 특화 자동 채점 플랫폼입니다. 교사가 참고 자료, 평가 루브릭, 학생 답안을 업로드하면, LLM이 이를 종합적으로 분석하여 채점하고 결과와 피드백을 제공하는 것을 목표로 합니다.

---

## 2. 기술 스택 및 환경

- **UI Framework**: `Streamlit`
- **Package Manager**: `uv`
- **LLM (채점 엔진)**: `google/gemini-2.5-flash`
    - **Python Library**: `google-genai`
- **Embedding Model (RAG용)**: `nlpai-lab/KURE-v1`
    - **Python Library**: `sentence-transformers`
- **Vector Database**: `FAISS`
- **데이터 처리**: `pandas` 등

---

## 3. 시스템 아키텍처

1. **사용자 (교사)**: 웹 UI를 통해 채점 유형 선택, 파일 업로드, 채점 실행 및 결과 확인.
2. **프론트엔드 (Streamlit)**: 사용자 인터페이스 제공 및 백엔드와 데이터 통신.
3. **백엔드 (Python)**: 파일 처리, 채점 유형에 따른 로직 분기, Gemini API 프롬프트 생성 및 호출, 결과 파싱.
4. **채점 엔진 (Gemini 2.5 Flash API)**: 프롬프트를 기반으로 텍스트 또는 이미지를 분석하여 채점 수행.

---

## 4. 핵심 기능 상세

### 4.1. 채점 유형 선택

사용자는 플랫폼에서 다음 두 가지 채점 유형 중 하나를 선택합니다.

- **📝 서술형 문항**: 학생 답안이 텍스트 형식인 경우.
- **🗺️ 백지도형 문항**: 학생 답안이 이미지(백지도) 형식인 경우.

### 4.2. 입력 데이터 처리

### 참고 자료 (RAG - 서술형 전용)

- **입력**: 문항 제작에 사용된 문서 (PDF, DOCX 등).
- **RAG 파이프라인**:
    1. **업로드**: 사용자가 UI를 통해 문서 파일 업로드.
    2. **청킹**: 문서를 의미 있는 단위로 분할.
    3. **임베딩**: **`nlpai-lab/KURE-v1`** 모델로 청크를 벡터화.
    4. **저장/인덱싱**: 생성된 벡터를 **FAISS** 인덱스에 저장.
    5. **검색**: 학생 답안을 쿼리 벡터로 변환하여, FAISS 인덱스에서 가장 관련성 높은 문서 조각 3개 추출.
    6. **전달**: 추출된 내용을 채점 프롬프트의 '참고 자료'로 포함.

### 평가 루브릭

- **입력**: 사용자가 웹 UI에서 직접 평가 요소와 채점 기준을 설정.
- **특징**:
    - **분석적 채점**: 여러 평가 요소와 각 요소별 채점 기준(점수, 내용)으로 구성.
    - **동적 UI**: 사용자가 평가 요소와 기준을 자유롭게 추가 및 삭제 가능.
    - **프롬프트 통합**: 입력된 루브릭은 구조화된 텍스트로 변환되어 채점 프롬프트에 전달.

### 학생 답안

- **서술형**: '학생 이름', '반', '답안' 3개 열로 구성된 Excel 파일.
- **백지도형**:
    1. '학생 이름', '반' 2개 열로 구성된 Excel 파일.
    2. 파일명에 학생 이름이 포함된 백지도 이미지 파일들 (예: `홍길동.jpg`).
- **처리**: 백엔드는 엑셀의 학생 이름과 이미지 파일명을 매칭하여 각 학생의 답안(텍스트 또는 이미지)을 식별.

---

## 5. 채점 실행 및 결과 출력

### 5.1. 프롬프트 엔지니어링

채점 유형에 따라 최적화된 프롬프트를 생성하여 Gemini API에 전달합니다. 프롬프트에는 참고 자료(서술형), 평가 루브릭, 학생 답안(텍스트 또는 이미지)이 포함되며, 반드시 지정된 JSON 형식으로 결과를 출력하도록 명시합니다.

### 5.2. 결과 데이터 구조

Gemini API는 각 학생에 대해 다음과 같은 구조의 데이터를 반환합니다.

- **채점 결과**: 평가 요소별로 부여된 점수와 선택된 채점 기준.
- **판단 근거**: 해당 점수를 부여한 구체적인 이유.
- **피드백**: 학생의 답안 개선을 위한 제언.

### 5.3. 결과 표시 및 저장

- **결과 시각화**: 백엔드는 API 응답을 파싱하여 프론트엔드로 전달합니다. Streamlit UI는 각 학생의 채점 결과, 판단 근거, 피드백을 명확하고 이해하기 쉬운 형태로 시각화하여 보여줍니다.
- **엑셀로 저장**: 사용자는 전체 학생의 채점 결과를 **Excel 파일로 다운로드**할 수 있는 기능을 제공받습니다. 이 파일에는 학생 정보, 원본 답안, 채점 결과, 판단 근거, 피드백이 모두 포함됩니다.